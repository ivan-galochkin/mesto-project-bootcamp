(()=>{"use strict";var e=function(e,r,o){r.validity.valid?n(e,r,o):t(e,r,r.validationMessage,o)},t=function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)},n=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},r=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove(n.inactiveButtonClass)):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))},o=document.querySelector(".page"),u=o.querySelector("#element").content,c=o.querySelector(".elements");function i(e,t,n,r,o){var i=function(e,t,n,r,o){var c=u.querySelector(".element").cloneNode(!0);c.querySelector(".element__title").textContent=e;var i=c.querySelector(".element__image");c.setAttribute("id",n),i.src=t,i.alt=e,i.addEventListener("click",(function(){return function(e,t){B.src=t,B.alt=e,D.textContent=e,K(z)}(e,t)}));var a=c.querySelector(".element__delete-button");a.addEventListener("click",(function(){return C(n)})),o._id!==U&&a.remove();var p=c.querySelector(".element__like");return p.addEventListener("click",(function(){return function(e){e.classList.contains("element__like_active")?g(e):L(e)}(p)})),c.querySelector(".element__like-number").textContent=r,c}(e,t,n,r,o);c.prepend(i)}var a=document.querySelector(".page"),p=a.querySelector(".profile"),l=a.querySelector(".elements"),s=a.querySelector("#popup-mesto"),f=a.querySelector("#popup-info"),d=a.querySelector("#popup-avatar"),m=p.querySelector(".profile__avatar"),_=s.querySelector(".popup__form"),v=_.querySelector("#popup-mesto-name__input"),y=_.querySelector("#popup-mesto-link__input"),h=d.querySelector("#popup-avatar__input"),b=f.querySelector("#popup-info-name__input"),S=f.querySelector("#popup-info-profession__input"),q=f.querySelector(".popup__button"),E=d.querySelector(".popup__button"),k=s.querySelector(".popup__button"),C=function(e){return fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/"+e,{method:"DELETE",headers:{authorization:"8bf2e7ea-b387-4df1-bce9-c81af37b4521"}}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).then((function(){return l.querySelector("[id='".concat(e,"']")).remove()})).catch((function(e){return console.log(e)}))},L=function(e){var t=e.parentElement.parentElement.parentElement.id,n=e.parentElement.lastElementChild;return fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/likes/"+t,{method:"PUT",headers:{authorization:"8bf2e7ea-b387-4df1-bce9-c81af37b4521"}}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).then((function(){return e.classList.add("element__like_active")})).then((function(){return n.textContent=Number(n.textContent)+1})).catch((function(e){return console.log(e)}))},g=function(e){var t=e.parentElement.parentElement.parentElement.id,n=e.parentElement.lastElementChild;return fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/likes/"+t,{method:"DELETE",headers:{authorization:"8bf2e7ea-b387-4df1-bce9-c81af37b4521"}}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).then((function(){return e.classList.remove("element__like_active")})).then((function(){return n.textContent=Number(n.textContent)-1})).catch((function(e){return console.log(e)}))},x=document.querySelector(".page"),j=x.querySelector(".profile"),P=j.querySelector(".profile__header"),T=j.querySelector(".profile__subtitle"),A=j.querySelector(".profile__avatar"),z=x.querySelector(".popup-image"),N=x.querySelector("#popup-mesto"),w=x.querySelector("#popup-avatar"),B=z.querySelector(".popup-image__image"),D=z.querySelector(".popup-image__subtitle"),O=x.querySelector("#popup-info"),J=N.querySelector(".popup__button"),H=w.querySelector(".popup__button"),M=O.querySelector(".popup__button"),U=0;var F=function(e){P.textContent=e.name,T.textContent=e.about,A.src=e.avatar,U=e._id};function G(e){"Escape"===e.key&&I(document.querySelector(".popup_opened"))}function I(e){document.removeEventListener("keydown",G),e.classList.remove("popup_opened")}function K(e){document.addEventListener("keydown",G),e.classList.add("popup_opened")}var Q=document.querySelector(".page"),R=Q.querySelector(".profile"),V=R.querySelector(".profile__edit-button"),W=R.querySelector(".profile__add-button"),X=R.querySelector(".profile__avatar-button"),Y=Q.querySelector("#popup-info"),Z=Y.querySelector(".popup__form"),$=Y.querySelector(".popup__close-button"),ee=Q.querySelector("#popup-mesto"),te=Q.querySelector("#popup-avatar"),ne=te.querySelector(".popup__close-button"),re=ee.querySelector(".popup__form"),oe=ee.querySelector(".popup__close-button"),ue=te.querySelector(".popup__form"),ce=Q.querySelector(".popup-image"),ie=ce.querySelector(".popup__close-button"),ae=Q.querySelectorAll(".popup");V.addEventListener("click",(function(){!function(e,t){var n=e.querySelector("#popup-info-name__input"),r=e.querySelector("#popup-info-profession__input");n.value=t.querySelector(".profile__header").textContent,r.value=t.querySelector(".profile__subtitle").textContent}(Y,R),K(Y)})),X.addEventListener("click",(function(){K(te)})),ne.addEventListener("click",(function(){return I(te)})),W.addEventListener("click",(function(){return K(ee)})),oe.addEventListener("click",(function(){return I(ee)})),re.addEventListener("submit",(function(e){return function(e){e.preventDefault(),J.textContent="Сохранение...",function(e){fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards",{method:"POST",headers:{authorization:"8bf2e7ea-b387-4df1-bce9-c81af37b4521","Content-Type":"application/json"},body:JSON.stringify({name:v.value,link:y.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return i(e.name,e.link,e._id,0,e.owner)})).then((function(){return I(s)})).then((function(){return k.textContent="Создать"})).then((function(){return e.target.reset()})).catch((function(e){return console.log(e)}))}(e)}(e)})),$.addEventListener("click",(function(){return I(Y)})),Z.addEventListener("submit",(function(e){return function(e){e.preventDefault(),M.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/users/me",{method:"PATCH",headers:{authorization:"8bf2e7ea-b387-4df1-bce9-c81af37b4521","Content-Type":"application/json"},body:JSON.stringify({name:b.value,about:S.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return F(e)})).then((function(){return I(f)})).then((function(){return q.textContent="Сохранить"})).catch((function(e){return console.log(e)}))}(e)})),ie.addEventListener("click",(function(){return I(ce)})),ue.addEventListener("submit",(function(e){return function(e){e.preventDefault(),H.textContent="Сохранение...",function(e){var t=h.value;fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/users/me/avatar",{method:"PATCH",headers:{authorization:"8bf2e7ea-b387-4df1-bce9-c81af37b4521","Content-Type":"application/json"},body:JSON.stringify({avatar:h.value})}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).then((function(){return m.src=t})).then((function(){return I(d)})).then((function(){return E.textContent="Сохранить"})).then((function(){return e.target.reset()})).catch((function(e){return console.log(e)}))}(e)}(e)})),document.removeEventListener("keydown",G),function(e){e.forEach((function(e){e.addEventListener("click",(function(t){t.target===t.currentTarget&&I(e)}))}))}(ae),G(ae),function(t,n){Array.from(n.querySelectorAll(t.formSelector)).forEach((function(n){!function(t,n){var o=Array.from(t.querySelectorAll(n.inputSelector)),u=t.querySelector(n.submitButtonSelector);r(o,u,n),o.forEach((function(r){e(t,r,n)})),o.forEach((function(c){c.addEventListener("input",(function(){r(o,u,n),e(t,c,n)}))}))}(n,t)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error"},Q),setTimeout((function(){te.classList.remove("popup_preload"),ee.classList.remove("popup_preload"),Y.classList.remove("popup_preload"),ce.classList.remove("popup_preload")}),500),fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/users/me",{headers:{authorization:"8bf2e7ea-b387-4df1-bce9-c81af37b4521"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return F(e)})).catch((function(e){return console.log(e)})),fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards",{headers:{authorization:"8bf2e7ea-b387-4df1-bce9-c81af37b4521"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e.slice().reverse().forEach((function(e){return i(e.name,e.link,e._id,e.likes.length,e.owner)}))})).catch((function(e){return console.log(e)}))})();